---
title: "Self report measures by ECA "
author: "Michelle.VanTieghem"
date: "10/10/2019"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  png_document:
    toc: yes
---

# Readme
Includes analysis of group differences in  \
1) positive affect to rewards  and setbacks \
2) frustration \
3) motivation \ 
4) perceived control \
5) perceived reinforcement \

For perceived effort, see separate script "ECA_effects_on_perceived_effort.Rmd"

```{r, include = F, warnings = F, echo=FALSE, message = F}
source("../../../0_R_analysis_setup_file.R")
```


```{r}
# load all data with PCA added!
load("data/all_pacct_effort_data_with_PCA.rda")
```


# descriptives 
## check correlations

win feeling, motivated, fun, perceived control all correlated.
frustated correlated with perceived reinforce & age 

```{r}
self_report_cor_df <- beh_scan_ECA_wide %>% 
  dplyr::select(PC1_log, prop_hard_choices, 
        AGE.x, perceived_control, perceived_effort_ave, 
         median_motor_RT_ave,
         perceived_reinforce, Reinforce_rate,
         lose_feeling, win_feeling, 
         frustrated, motivated, 
         fun, sleepy) %>%
  # reformatting for future table/figure use.
  rename('Prop Hard Choices' = prop_hard_choices, 
          'Age (years)' = AGE.x, 
         'ECA score' = PC1_log, 
         'Affect to setbacks' = lose_feeling, 
         'Affect to rewards' = win_feeling, 
         'Perceived reinforcement' = perceived_reinforce, 
         'Frustration' = frustrated, 
         'Motivation' = motivated, 
         'Perceived Control' = perceived_control,
         'Perceived effort' = perceived_effort_ave, 
         'Motor speed' = median_motor_RT_ave,
         'Actual Reinforcement' = Reinforce_rate, 
         'Amount of Fun' = fun, 
         'Sleepiness' = sleepy) 
# save to make table later.
save(self_report_cor_df, file = "tables/corr_table_self_report_data.Rdata")

```

## visualize correlations
```{r}
# reformat for corrplot
var_cor <- self_report_cor_df %>%
  as.matrix() %>% # convert to matrix
  rcorr() # calculate correlations

corrplot(var_cor$r, method = "color", type = "lower")

# save plot
png("figures/self_report_ECA/self_report_variables_corrplot.png")
corrplot(var_cor$r, method = "color", type = "lower")
dev.off()
```

# positive/ negative affect

```{r tre}
# make long version of perceived effort data
pos_affect_df <- beh_scan_ECA_wide %>% 
  gather(key = "condition", value = "positive_affect", 
          win_feeling,lose_feeling) %>%
  mutate(condition = as.factor(ifelse(condition == "win_feeling", 
                                      "Rewards", "Setbacks"))) %>%
  dplyr::select(SUBJECTID, GROUP_ECA, PC1_log, SEX.c, AGE.c,  positive_affect, condition, 
         setback_Amyg, reward_Amyg, setback_VS, reward_VS, 
         perceived_effort_ave, Reinforce_rate.c, perceived_reinforce,
         perceived_control, median_motor_RT_ave) %>%
  filter(!is.na(positive_affect) & !is.na(condition) & !is.na(AGE.c) & !is.na(SEX.c)) %>%
  mutate(GROUP_ECA = as.factor(GROUP_ECA))
```

## group x condition: SIG
controlling for all relevant variables !
```{r ert}
pos_affect_mod_g <- lmer(positive_affect ~ condition * GROUP_ECA + AGE.c + SEX.c + 
                           #perceived_effort_ave + perceived_reinforce + perceived_control + 
                           #Reinforce_rate.c + median_motor_RT_ave + 
                          (1 | SUBJECTID),
   data = pos_affect_df)
summary(pos_affect_mod_g)
```

## PC1 x condition : SIG 
```{r}
pos_affect_mod_PC1 <- lmer(positive_affect ~ condition * PC1_log + AGE.c + SEX.c +
                           #perceived_effort_ave + perceived_reinforce + perceived_control + 
                           #Reinforce_rate.c + median_motor_RT_ave + 
                          (1 | SUBJECTID),
   data = pos_affect_df)

summary(pos_affect_mod_PC1)
```

## plot of group effect
```{r}
# get effect  df tidy
affect_effect <-  as.data.frame(effect("condition:GROUP_ECA", pos_affect_mod_g, confint=TRUE))

plot_effect <- ggplot(affect_effect,aes(x = GROUP_ECA, y = fit)) +
 geom_point(size = 3, color = "black") + theme_classic() + 
  geom_errorbar(aes(ymin = lower, ymax = upper),position=position_dodge(.9), width = 0.25) +
  geom_jitter(data = pos_affect_df,  aes(x = GROUP_ECA, y = positive_affect),
              width = 0.2, height = 0.05, pch = 21,
             alpha = 0.2, fill = dark_blue) +
   theme(legend.position = "none") + facet_grid(~condition) +
  theme_classic() + ylab("Positive Affect") + coord_cartesian(ylim=c(1,4)) +
  xlab ("GROUP") + theme(legend.position = "none")
plot_effect

ggsave(plot_effect, file = "figures/self_report_ECA/positive_affect_by_group.png", width = 6, height = 4)

```


## plot of cumulative ECA effect
```{r}
# get effect  df tidy
affect_effect <-  as.data.frame(effect("condition:PC1_log", pos_affect_mod_PC1, confint=TRUE))

plot_effect <- ggplot(affect_effect, aes(x = PC1_log, y = fit)) +
 geom_line(color = dark_blue) + theme_classic() + 
  geom_ribbon(aes(ymin = lower, ymax = upper), fill = dark_blue, alpha = 0.3) +
  geom_jitter(data = pos_affect_df,  aes(x = PC1_log, y = positive_affect),
              width = 0.2, height = 0.05, pch = 21,
             alpha = 0.2, fill = dark_blue) +
   theme(legend.position = "none") + facet_grid(~condition) +
  theme_classic() + ylab("Positive Affect") + coord_cartesian(ylim=c(1,4)) +
  xlab ("Cumulative ECA score") + theme(legend.position = "none")
plot_effect

ggsave(plot_effect, file = "figures/self_report_ECA/positive_affect_by_PC1.png", width = 6, height = 4)

```


# Frustration 
because positive-negative affect is significant, let's account for it... 
make a difference scores, since that's what varies by ECA.
```{r}
beh_scan_ECA_wide$diff_pos_affect <- beh_scan_ECA_wide$win_feeling - beh_scan_ECA_wide$lose_feeling

```


## ECA group effect on frustration: NS
perceived reinforcement is significant, but only when yoou also include motor speed....
```{r}
frust_mod1_g <- lm(frustrated ~ GROUP_ECA + AGE.c  + SEX.c  + 
                     perceived_reinforce +
                    # diff_pos_affect + perceived_effort_ave  +  perceived_control + perceived_control +
                      median_motor_RT_ave, #+ Reinforce_rate,
                 data = beh_scan_ECA_wide)
summary(frust_mod1_g)
```

## PC1 effect on frustration : NS
```{r}
frust_mod1_PC1 <- lm(frustrated ~ PC1_log + AGE.c  + SEX.c +
                     perceived_reinforce +
                    # diff_pos_affect + perceived_effort_ave  +  perceived_control + perceived_control +
                      median_motor_RT_ave, #+ Reinforce_rate,
                 data = beh_scan_ECA_wide)
summary(frust_mod1_PC1)
```


# Motivation 
## Group effect on motivation: SIG 
only when account for  effects of perceived control and motor speed! 
HUGE EFFECT OF PERCEIVED CONTROL. 
```{r}
motivate_mod1_g <- lm(motivated ~ GROUP_ECA + AGE.c  + SEX.c  +
                        perceived_control  +
                     #perceived_effort_ave  + perceived_reinforce +   diff_pos_affect +
                       median_motor_RT_ave, # + Reinforce_rate,
                 data = beh_scan_ECA_wide)
summary(motivate_mod1_g)
```

### PC1 effect on motivation: SIG when accounting for perceived control and motor speed! 
```{r}
motivate_mod1_PC1 <- lm(motivated ~  PC1_log +  AGE.c  + SEX.c + 
                        perceived_control  +
                     #perceived_effort_ave  + perceived_reinforce +   diff_pos_affect +
                       median_motor_RT_ave, # + Reinforce_rate,
                 data = beh_scan_ECA_wide)
summary(motivate_mod1_PC1)

```

```{r}
affect_effect <-  as.data.frame(effect("PC1_log", motivate_mod1_PC1, confint=TRUE))

plot_effect <- ggplot(affect_effect, aes(x = PC1_log, y = fit)) +
 geom_line(color = dark_blue) + theme_classic() + 
  geom_ribbon(aes(ymin = lower, ymax = upper), fill = dark_blue, alpha = 0.3) +
  geom_jitter(data = beh_scan_ECA_wide,  aes(x = PC1_log, y = motivated),
              width = 0.2, height = 0.05, pch = 21,
             alpha = 0.2, fill = dark_blue) +
   theme(legend.position = "none") + 
  theme_classic() + ylab("Self-reported motivation") + #coord_cartesian(ylim=c(1,3)) +
  xlab ("Cumulative ECA score") + theme(legend.position = "none")
plot_effect

ggsave(plot_effect, file = "figures/self_report_ECA/motivation_by_PC1.png", width = 6, height = 4)
```


# Fun 
## Group effect on fun: NS
significant age effect, perceived contrrol, perceived reinforcementt.
```{r}
fun_mod1_g <- lm(fun ~ GROUP_ECA + AGE.c  + SEX.c  + 
                   perceived_reinforce + perceived_control +
                    # perceived_effort_ave + + diff_pos_affect +
                   Reinforce_rate, #+ median_motor_RT_ave, 
                 data = beh_scan_ECA_wide)
summary(fun_mod1_g)
```

## PC1 effect on fun: NS
```{r}
fun_mod1_PC1 <- lm(fun ~  PC1_log +  AGE.c  + SEX.c  + 
                   perceived_reinforce + perceived_control +
                    # perceived_effort_ave + + diff_pos_affect +
                   Reinforce_rate, #+ median_motor_RT_ave, 
                 data = beh_scan_ECA_wide)
summary(fun_mod1_PC1)
```

# perceived control 
## Group effect on perceived control: NS
```{r}
control_mod1_g <- lm(perceived_control ~ GROUP_ECA +  AGE.c  + SEX.c  + diff_pos_affect, # +
                   #  perceived_effort_ave + perceived_reinforce + Reinforce_rate +
                    #   median_motor_RT_ave, 
                 data = beh_scan_ECA_wide)
summary(control_mod1_g)
```

### PC1 effect on perceived control: NS
huge effect of positive affect. 
```{r}
control_mod1_PC1 <- lm(perceived_control ~  PC1_log + AGE.c  + SEX.c  + diff_pos_affect, # +
                   #  perceived_effort_ave + perceived_reinforce + Reinforce_rate +
                    #   median_motor_RT_ave, 
                 data = beh_scan_ECA_wide)
summary(control_mod1_PC1)
```

# Perceived reinforcement
## Group effect on perceived reinforcemennt: SIG
when conntrolling for actual reinforce rate and motor speed
```{r}
perceived_reinforce_mod1_g <- lm(perceived_reinforce ~ GROUP_ECA +  
                                   AGE.c  + SEX.c  + Reinforce_rate +
                   #  perceived_effort_ave + perceived_control + #  diff_pos_affect +
                      median_motor_RT_ave, 
                 data = beh_scan_ECA_wide)
summary(perceived_reinforce_mod1_g)
```


## plot of group effect
```{r }
# get effect  df tidy
affect_effect <-  as.data.frame(effect("GROUP_ECA", perceived_reinforce_mod1_g, confint=TRUE))

plot_effect <- ggplot(affect_effect,aes(x = GROUP_ECA, y = fit)) +
 geom_point(size = 3, color = "black") + theme_classic() + 
  geom_errorbar(aes(ymin = lower, ymax = upper),position=position_dodge(.9), width = 0.25) +
  geom_jitter(data = beh_scan_ECA_wide,  aes(x = GROUP_ECA, y = perceived_reinforce),
              width = 0.2, height = 0.05, pch = 21,
             alpha = 0.2, fill = dark_blue) +
   theme(legend.position = "none") + 
  theme_classic() + ylab("Perceived Reinforcemment") + coord_cartesian(ylim=c(1,3)) +
  xlab ("GROUP") + theme(legend.position = "none")
plot_effect

ggsave(plot_effect, file = "figures/self_report_ECA/perceived_reinforce_by_group.png", width = 2.5, height = 4)

```

## PC1 effect on perceived reinforcement: SIG
unless you include perceived effrt, then it's a trend. 
```{r}
perceived_reinforce_mod1_PC1 <- lm(perceived_reinforce ~  PC1_log + 
                                   AGE.c  + SEX.c  + Reinforce_rate +
                   #  perceived_effort_ave + perceived_control + #  diff_pos_affect +
                    median_motor_RT_ave, 
                 data = beh_scan_ECA_wide)
summary(perceived_reinforce_mod1_PC1)
```


## plot of cumulative ECA effect for perceived reinforcement
```{r}
summary(beh_scan_ECA_wide$perceived_reinforce)
# get effect  df tidy
affect_effect <-  as.data.frame(effect("PC1_log", perceived_reinforce_mod1_PC1, confint=TRUE))

plot_effect <- ggplot(affect_effect, aes(x = PC1_log, y = fit)) +
 geom_line(color = dark_blue) + theme_classic() + 
  geom_ribbon(aes(ymin = lower, ymax = upper), fill = dark_blue, alpha = 0.3) +
  geom_jitter(data = beh_scan_ECA_wide,  aes(x = PC1_log, y = perceived_reinforce),
              width = 0.2, height = 0.05, pch = 21,
             alpha = 0.2, fill = dark_blue) +
   theme(legend.position = "none") + 
  theme_classic() + ylab("Perceived reinforcement") + coord_cartesian(ylim=c(1,3)) +
  xlab ("Cumulative ECA score") + theme(legend.position = "none")
plot_effect

ggsave(plot_effect, file = "figures/self_report_ECA/perceived_reinforce_by_PC1.png", width = 6, height = 4)

```


### Group effect on actual reinforcement rate rate: no, good because random! 
```{r}
reinforce_mod1_g <- lm(Reinforce_rate ~ GROUP_ECA ,
                 data = beh_scan_ECA_wide)
summary(reinforce_mod1_g)
```

### PC1 effect on actual reinforcement: no.
```{r}
reinforce_mod1_PC1 <- lm(Reinforce_rate ~  PC1_log ,
                 data = beh_scan_ECA_wide)
summary(reinforce_mod1_PC1)
```
